<!DOCTYPE html>
<html lang="es" data-theme="{{TEMA_PREFERIDO}}">
<head>
<meta charset="UTF-8" />
<title>AuriPortal ‚Äî Mi Universo Personal</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes" />
<meta name="theme-color" content="#ffd86b" />
<meta name="description" content="Tu universo personal de pr√°ctica con Aurel√≠n" />
<link rel="shortcut icon" type="image/png" href="https://images.typeform.com/images/tXs4JibWTbvb" />
<link rel="stylesheet" href="/css/theme-variables.css" />
<link rel="stylesheet" href="/css/theme-overrides.css" />
<style>
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  body {
    font-family: 'Segoe UI', sans-serif;
    background: var(--bg-primary, #faf7f2);
    color: var(--text-primary, #333);
    padding: 20px;
    line-height: 1.6;
  }

  .container {
    max-width: 1200px;
    margin: 0 auto;
  }

  .header {
    text-align: center;
    margin-bottom: 40px;
    padding: 30px 20px;
    background: var(--header-bg);
    border-radius: var(--radius-lg, 20px);
    box-shadow: 0 6px 14px var(--shadow-md);
  }

  .header h1 {
    font-size: 2rem;
    color: var(--text-accent);
    margin-bottom: 10px;
  }

  .header .info {
    font-size: 1.1rem;
    color: var(--text-muted);
    margin-top: 10px;
  }

  .grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
  }

  .card {
    background: var(--bg-card, #ffffff);
    border-radius: var(--radius-lg, 20px);
    padding: 25px;
    box-shadow: 0 6px 14px var(--shadow-sm, rgba(0,0,0,0.08));
    color: var(--text-primary, #333);
  }

  .card h2 {
    font-size: 1.5rem;
    color: var(--text-accent);
    margin-bottom: 20px;
    padding-bottom: 10px;
    border-bottom: 2px solid var(--border-accent);
  }

  .card.full-width {
    grid-column: 1 / -1;
  }

  .buzon {
    max-height: 400px;
    overflow-y: auto;
    padding-right: 10px;
  }

  .buzon::-webkit-scrollbar {
    width: 8px;
  }

  .buzon::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 10px;
  }

  .buzon::-webkit-scrollbar-thumb {
    background: var(--accent-primary);
    border-radius: 10px;
  }

  .nota-item, .canalizacion-item, .diario-item {
    background: var(--card-bg);
    padding: 15px;
    margin-bottom: 15px;
    border-radius: 12px;
    border-left: 4px solid var(--border-accent);
  }

  .nota-item.no-leida, .canalizacion-item.no-leida {
    background: var(--card-bg-active);
    border-left-color: var(--accent-primary);
    font-weight: 600;
  }

  .nota-fecha, .canalizacion-fecha, .diario-fecha {
    font-size: 0.85rem;
    color: var(--text-muted);
    margin-bottom: 8px;
    font-weight: 600;
  }

  .nota-contenido, .canalizacion-mensaje, .diario-contenido {
    color: var(--text-accent);
    line-height: 1.6;
  }

  .texto-vacio {
    color: #999;
    font-style: italic;
    text-align: center;
    padding: 20px;
  }

  .selector {
    margin-top: 15px;
  }

  .selector label {
    display: block;
    margin-bottom: 8px;
    color: var(--text-accent);
    font-weight: 600;
  }

  .selector select {
    width: 100%;
    padding: 12px;
    border: 2px solid var(--border-accent);
    border-radius: var(--radius-md, 16px);
    font-size: 1rem;
    background: var(--input-bg);
    color: var(--input-text);
    cursor: pointer;
  }

  .selector select:focus {
    outline: none;
    border-color: var(--input-focus-border, #f1c04e);
    box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.2);
  }

  .boton-guardar {
    margin-top: 15px;
    padding: 12px 24px;
    background: var(--gradient-primary);
    border: none;
    border-radius: var(--radius-md, 16px);
    font-size: 1rem;
    cursor: pointer;
    color: var(--button-text-color);
    font-weight: 600;
    box-shadow: 0 3px 10px var(--shadow-md);
    transition: all 0.2s ease;
    width: 100%;
  }

  .boton-guardar:hover {
    background: var(--gradient-hover);
    transform: scale(1.02);
  }

  .boton-guardar:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none;
  }

  .mensaje-exito {
    background: rgba(16, 185, 129, 0.2) !important;
    color: var(--accent-success) !important;
    padding: 12px;
    border-radius: var(--radius-md, 16px);
    margin-top: 10px;
    display: none;
    font-weight: 700 !important; /* VERDE = font-weight 700 */
  }

  .mensaje-exito.mostrar {
    display: block;
  }

  .volver {
    text-align: center;
    margin-top: 30px;
  }

  .volver a {
    display: inline-block;
    padding: 12px 24px;
    background: var(--gradient-primary) !important;
    color: var(--button-text-color) !important;
    text-decoration: none;
    border-radius: var(--radius-md, 16px);
    font-weight: 600;
    transition: all 0.2s ease;
  }

  .volver a:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
  }

  /* M√≥vil */
  @media (max-width: 768px) {
    body {
      padding: 15px;
    }

    .container {
      max-width: 100%;
    }

    .grid {
      grid-template-columns: 1fr;
      gap: 15px;
    }
    
    .header {
      padding: 20px 15px;
    }

    .header h1 {
      font-size: 1.5rem;
    }

    .header .info {
      font-size: 1rem;
    }

    .card {
      padding: 20px;
    }

    .card h2 {
      font-size: 1.3rem;
    }

    .item-header {
      flex-direction: column;
      align-items: flex-start;
      gap: 10px;
    }

    .item-acciones {
      width: 100%;
    }

    .btn-activar, .btn-editar, .btn-eliminar {
      flex: 1;
      min-width: 0;
    }
  }

  /* Escritorio grande */
  @media (min-width: 1200px) {
    .container {
      max-width: 1400px;
    }

    .grid {
      grid-template-columns: repeat(2, 1fr);
      gap: 25px;
    }

    .header h1 {
      font-size: 2.2rem;
    }

    .card h2 {
      font-size: 1.6rem;
    }
  }

  /* Estilos para Tabs */
  .tabs-container {
    margin-bottom: 30px;
  }

  .tabs-header {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
    border-bottom: 2px solid var(--border-accent);
    padding-bottom: 0;
  }

  .tab-button {
    padding: 12px 24px;
    background: transparent;
    border: none;
    border-bottom: 3px solid transparent;
    color: var(--text-secondary);
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    margin-bottom: -2px;
    border-radius: var(--radius-sm, 12px) var(--radius-sm, 12px) 0 0;
  }

  .tab-button:hover {
    color: var(--text-accent);
    background: rgba(124, 58, 237, 0.1);
  }

  html[data-theme="dark"] .tab-button:hover {
    background: rgba(124, 58, 237, 0.15);
  }

  .tab-button.active {
    color: var(--text-accent);
    border-bottom-color: var(--accent-primary);
    background: rgba(124, 58, 237, 0.15);
  }

  .tab-content {
    display: none;
    animation: fadeIn 0.3s ease;
  }

  .tab-content.active {
    display: block;
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .badge-info {
    background: var(--accent-primary) !important;
    color: var(--button-text-color) !important;
    padding: 4px 12px;
    border-radius: var(--radius-sm, 12px);
    font-size: 0.85rem;
    font-weight: 600;
  }

  .apadrinado-item {
    background: var(--bg-card) !important;
    border-left-color: var(--accent-primary) !important;
  }

  .limpieza-item {
    background: var(--bg-card) !important;
    border-left-color: var(--accent-success) !important;
  }

  .limpieza-item .item-descripcion p {
    margin: 5px 0;
    color: var(--text-primary) !important;
  }

  .transmutacion-item {
    background: var(--bg-card) !important;
    border-left-color: var(--accent-primary) !important;
    padding: 20px;
  }

  .transmutacion-item .item-descripcion p {
    margin: 8px 0;
    color: var(--text-primary) !important;
    line-height: 1.6;
  }

  .transmutacion-item .item-header {
    margin-bottom: 12px;
  }

  /* M√≥vil - Tabs */
  @media (max-width: 768px) {
    .tabs-header {
      flex-direction: column;
      gap: 5px;
    }

    .tab-button {
      width: 100%;
      text-align: left;
      padding: 10px 15px;
    }
  }
  </style>
</head>
<body>

  <div class="container">
    {{MENSAJE_PAUSADA}}
    
    <div class="header">
      <h1>üåü Mi Universo Personal</h1>
      <div class="info">
        <strong>{{NOMBRE}}</strong><br>
        Nivel {{NIVEL}} - Fase: {{FASE}}
      </div>
    </div>

    <!-- Sistema de Pesta√±as -->
    <div class="tabs-container">
      <div class="tabs-header">
        <button class="tab-button active" onclick="abrirTab('tab-decisiones')" id="btn-tab-decisiones">
          ‚ú® Mis Decisiones Iluminadas
        </button>
        <button class="tab-button" onclick="abrirTab('tab-comunicaciones')" id="btn-tab-comunicaciones">
          üí¨ Comunicaciones de Eugeni Hidalgo
        </button>
        <button class="tab-button" onclick="abrirTab('tab-transmutaciones')" id="btn-tab-transmutaciones">
          üîÆ Transmutaciones Energ√©ticas
        </button>
        <button class="tab-button" onclick="abrirTab('tab-configuracion')" id="btn-tab-configuracion">
          ‚öôÔ∏è Configuraci√≥n
        </button>
      </div>

      <!-- Pesta√±a 1: Mis Decisiones Iluminadas -->
      <div id="tab-decisiones" class="tab-content active">
        <!-- Mi Lugar -->
        <div class="card full-width">
        <h2>üè† Mis Lugares</h2>
        <p style="color: var(--text-secondary); margin-bottom: 10px;">
          Crea y gestiona tus lugares. Puedes tener varios, pero solo uno puede estar activo a la vez.
        </p>
        <div class="importante" style="padding: 12px; margin-bottom: 20px; border-radius: 8px;">
          <strong style="font-weight: 700;">‚ÑπÔ∏è Importante:</strong>
          <p style="margin: 5px 0 0 0; font-size: 0.95rem; font-weight: 600;">
            Para que tu lugar aparezca en la tabla de <strong>"Lugares Activados"</strong> y pueda recibir limpiezas energ√©ticas, 
            debes <strong>activarlo</strong> despu√©s de crearlo. Busca el bot√≥n <strong>"‚≠ê Activar Lugar"</strong> en cada lugar inactivo.
          </p>
        </div>
        
        <!-- Lista de lugares -->
        <div id="lista-lugares" class="lista-items">
          {{LUGARES_HTML}}
        </div>
        
        <!-- Formulario de crear/editar lugar -->
        <div class="formulario-crear" id="form-lugar" style="margin-top: 20px; padding-top: 20px; border-top: 2px solid var(--border-accent);">
          <h3 style="margin-bottom: 15px; color: var(--text-accent);" id="titulo-form-lugar">‚ûï Crear Nuevo Lugar</h3>
          <input type="hidden" id="lugar-id-editar" value="">
          <div style="margin-bottom: 15px;">
            <label for="lugar-nombre" style="display: block; margin-bottom: 5px; color: var(--text-accent); font-weight: 600;">Nombre del lugar:</label>
            <input type="text" id="lugar-nombre" placeholder="Ej: Mi casa, Mi oficina..." 
                   style="width: 100%; padding: 12px; border: 2px solid var(--border-accent); border-radius: var(--radius-md, 16px); font-size: 1rem; background: var(--input-bg); color: var(--input-text);">
          </div>
          <div style="margin-bottom: 15px;">
            <label for="lugar-descripcion" style="display: block; margin-bottom: 5px; color: var(--text-accent); font-weight: 600;">Descripci√≥n (Direcci√≥n completa):</label>
            <textarea id="lugar-descripcion" placeholder="Es importante poner la direcci√≥n completa porque eso nos permite poder consignar el lugar. Es un requerimiento indispensable para poder realizar la limpieza energ√©tica del lugar activado." rows="4"
                      style="width: 100%; padding: 12px; border: 2px solid var(--border-accent); border-radius: var(--radius-md, 16px); font-size: 1rem; resize: vertical; background: var(--input-bg); color: var(--input-text);"></textarea>
            <p style="font-size: 0.85rem; color: var(--text-muted); margin-top: 5px; font-style: italic;">
              ‚ö†Ô∏è Es importante poner la direcci√≥n completa porque eso nos permite poder consignar el lugar. Es un requerimiento indispensable para poder realizar la limpieza energ√©tica del lugar activado.
            </p>
          </div>
          <div style="display: flex; gap: 10px;">
            <button class="boton-guardar" onclick="guardarLugar()" style="flex: 1;">
              <span id="texto-boton-lugar">Crear Lugar</span>
            </button>
            <button onclick="cancelarEdicionLugar()" style="padding: 12px 24px; background: #ccc; border: none; border-radius: 8px; cursor: pointer; display: none;" id="btn-cancelar-lugar">
              Cancelar
            </button>
          </div>
          <div class="mensaje-exito" id="mensaje-lugar"></div>
        </div>
      </div>

      <!-- Proyecto Personal -->
      <div class="card full-width">
        <h2>üéØ Mis Proyectos Personales</h2>
        <p style="color: var(--text-secondary); margin-bottom: 20px;">
          Crea y gestiona tus proyectos personales. Puedes tener varios, pero solo uno puede estar activo a la vez.
        </p>
        
        <!-- Lista de proyectos -->
        <div id="lista-proyectos" class="lista-items">
          {{PROYECTOS_HTML}}
        </div>
        
        <!-- Formulario de crear/editar proyecto -->
        <div class="formulario-crear" id="form-proyecto" style="margin-top: 20px; padding-top: 20px; border-top: 2px solid var(--border-accent);">
          <h3 style="margin-bottom: 15px; color: var(--text-accent);" id="titulo-form-proyecto">‚ûï Crear Nuevo Proyecto</h3>
          <input type="hidden" id="proyecto-id-editar" value="">
          <div style="margin-bottom: 15px;">
            <label for="proyecto-nombre" style="display: block; margin-bottom: 5px; color: var(--text-accent); font-weight: 600;">Nombre del proyecto:</label>
            <input type="text" id="proyecto-nombre" placeholder="Ej: Escribir un libro, Aprender idioma..." 
                   style="width: 100%; padding: 12px; border: 2px solid var(--border-accent); border-radius: var(--radius-md, 16px); font-size: 1rem; background: var(--input-bg); color: var(--input-text);">
          </div>
          <div style="margin-bottom: 15px;">
            <label for="proyecto-descripcion" style="display: block; margin-bottom: 5px; color: var(--text-accent); font-weight: 600;">Descripci√≥n:</label>
            <textarea id="proyecto-descripcion" placeholder="Describe el proyecto..." rows="3"
                      style="width: 100%; padding: 12px; border: 2px solid var(--border-accent); border-radius: var(--radius-md, 16px); font-size: 1rem; resize: vertical; background: var(--input-bg); color: var(--input-text);"></textarea>
          </div>
          <div style="display: flex; gap: 10px;">
            <button class="boton-guardar" onclick="guardarProyecto()" style="flex: 1;" {{DESHABILITADO_ATTR}}>
              <span id="texto-boton-proyecto">Crear Proyecto</span>
            </button>
            <button onclick="cancelarEdicionProyecto()" style="padding: 12px 24px; background: #ccc; border: none; border-radius: 8px; cursor: pointer; display: none;" id="btn-cancelar-proyecto">
              Cancelar
            </button>
          </div>
          <div class="mensaje-exito" id="mensaje-proyecto"></div>
        </div>
      </div>

        <!-- Apadrinados (solo lectura) -->
        <div class="card full-width">
          <h2>üë• Mis Apadrinados</h2>
          <p style="color: var(--text-secondary); margin-bottom: 20px;">
            Esta secci√≥n muestra los apadrinados que tienes asignados. La gesti√≥n de apadrinados se realiza desde el panel de administraci√≥n.
          </p>
          <div id="lista-apadrinados" class="lista-items">
            {{APADRINADOS_HTML}}
          </div>
        </div>
      </div>

      <!-- Pesta√±a 2: Comunicaciones de Eugeni Hidalgo -->
      <div id="tab-comunicaciones" class="tab-content" style="display: none;">
        <div class="grid">
          <!-- Buz√≥n de Entrada: Notas -->
          <div class="card">
            <h2>üìù Notas de Eugeni Hidalgo</h2>
            <div class="buzon">
              {{NOTAS_HTML}}
            </div>
          </div>

          <!-- Buz√≥n de Entrada: Canalizaciones -->
          <div class="card">
            <h2>üí¨ Canalizaciones y Comentarios</h2>
            <div class="buzon">
              {{CANALIZACIONES_HTML}}
            </div>
          </div>
        </div>
      </div>

      <!-- Pesta√±a 3: Transmutaciones Energ√©ticas -->
      <div id="tab-transmutaciones" class="tab-content" style="display: none;">
        <div class="card full-width">
          <h2>üîÆ Transmutaciones Energ√©ticas</h2>
          <p style="color: var(--text-secondary); margin-bottom: 20px;">
            Esta secci√≥n muestra un panel informativo de los aspectos energ√©ticos que ya est√°n limpios en tu energ√≠a. 
            Aqu√≠ puedes ver el estado actual de tus transmutaciones energ√©ticas completadas.
          </p>
          <div id="lista-transmutaciones" class="lista-items">
            {{TRANSMUTACIONES_HTML}}
          </div>
        </div>
      </div>

      <!-- Pesta√±a 4: Configuraci√≥n -->
      <div id="tab-configuracion" class="tab-content" style="display: none;">
        <div class="card full-width">
          <h2>‚öôÔ∏è Configuraci√≥n</h2>
          
          <!-- Secci√≥n: Apariencia -->
          <div style="margin-bottom: 30px; padding-bottom: 20px; border-bottom: 2px solid var(--border-accent);">
            <h3 style="color: var(--text-accent); font-size: 1.3rem; margin-bottom: 15px;">üé® Apariencia</h3>
            <p style="color: var(--text-secondary, #666); margin-bottom: 20px;">
              Personaliza el aspecto visual del portal seleccionando tu tema preferido.
            </p>
            
            <div style="margin-bottom: 20px;">
              <label for="tema-select" style="display: block; margin-bottom: 10px; color: var(--text-accent); font-weight: 600; font-size: 1.1rem;">
                üåì Tema:
              </label>
              <select id="tema-select" 
                      style="width: 100%; padding: 12px; border: 2px solid var(--border-accent); border-radius: var(--radius-md, 16px); font-size: 1rem; background: var(--input-bg); color: var(--input-text);"
                      onchange="guardarTema()">
                <option value="light" {{TEMA_LIGHT_SELECTED}}>‚òÄÔ∏è Tema Claro</option>
                <option value="dark" {{TEMA_DARK_SELECTED}}>üåô Tema Oscuro</option>
              </select>
              <p style="font-size: 0.9rem; color: var(--text-muted); margin-top: 8px; font-style: italic;">
                Elige entre el tema claro (por defecto) o el tema oscuro para una experiencia m√°s c√≥moda.
              </p>
            </div>
            
            <div class="mensaje-exito" id="mensaje-tema" style="display: none; margin-top: 15px;"></div>
          </div>
          
          <!-- Secci√≥n: Configuraci√≥n de Meditaci√≥n -->
          <div style="margin-bottom: 20px;">
            <h3 style="color: var(--text-accent); font-size: 1.3rem; margin-bottom: 15px;">üîî Meditaci√≥n</h3>
            <p style="color: var(--text-secondary); margin-bottom: 20px;">
              Personaliza tu experiencia de meditaci√≥n seleccionando el tono que se reproducir√° al finalizar el reloj de meditaci√≥n.
            </p>
            
            <div style="margin-bottom: 20px;">
              <label for="tono-meditacion-select" style="display: block; margin-bottom: 10px; color: var(--text-accent); font-weight: 600; font-size: 1.1rem;">
                üîî Tono de finalizaci√≥n de meditaci√≥n:
              </label>
              <select id="tono-meditacion-select" 
                      style="width: 100%; padding: 12px; border: 2px solid var(--border-accent); border-radius: var(--radius-md, 16px); font-size: 1rem; background: var(--input-bg); color: var(--input-text);"
                      onchange="guardarTonoMeditacion()">
                <option value="">Usar tono por defecto del sistema</option>
                {{TONOS_HTML}}
              </select>
              <p style="font-size: 0.9rem; color: var(--text-muted); margin-top: 8px; font-style: italic;">
                Este tono se reproducir√° cuando finalice tu reloj de meditaci√≥n. Si no seleccionas ninguno, se usar√° el tono por defecto del sistema.
              </p>
            </div>
            
            <div class="mensaje-exito" id="mensaje-tono" style="display: none; margin-top: 15px;"></div>
          </div>
        </div>
      </div>
    </div>

    <div class="volver">
      <a href="/enter">‚Üê Volver al inicio</a>
    </div>
  </div>

  <style>
    .lista-items {
      margin-bottom: 20px;
    }
    
    .item-lista {
      background: var(--card-bg);
      padding: 15px;
      margin-bottom: 15px;
      border-radius: var(--radius-md, 16px);
      border-left: 4px solid var(--border-accent);
    }
    
    .item-lista.activo {
      background: var(--card-bg-active);
      border-left-color: var(--accent-primary);
      border: 2px solid var(--accent-primary);
    }
    
    .item-lista.inactivo {
      background: var(--card-bg);
      border-left-color: var(--border-accent);
      border: 2px solid var(--border-accent);
      opacity: 0.9;
    }
    
    .item-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }
    
    .item-header strong {
      color: var(--text-accent);
      font-size: 1.1rem;
    }
    
    .badge-activo {
      background: var(--accent-success) !important;
      color: #ffffff !important;
      padding: 4px 12px;
      border-radius: var(--radius-sm, 12px);
      font-size: 0.85rem;
      font-weight: 700 !important; /* VERDE = font-weight 700 */
    }
    
    .badge-inactivo {
      background: var(--accent-primary) !important;
      color: var(--button-text-color) !important;
      padding: 4px 12px;
      border-radius: var(--radius-sm, 12px);
      font-size: 0.85rem;
      font-weight: 600;
    }
    
    .item-descripcion {
      color: var(--text-secondary) !important;
      margin-bottom: 12px;
      line-height: 1.5;
    }
    
    .item-acciones {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    
    .btn-activar, .btn-editar, .btn-eliminar {
      padding: 8px 16px;
      border: none;
      border-radius: var(--radius-sm, 12px);
      font-size: 0.9rem;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.2s ease;
    }
    
    .btn-activar {
      background: var(--gradient-success) !important;
      color: #ffffff !important;
      font-weight: 700 !important; /* VERDE = font-weight 700 */
    }
    
    .btn-activar:hover {
      background: linear-gradient(135deg, #059669, #047857) !important;
    }
    
    .btn-activar.destacado {
      background: var(--gradient-success) !important;
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4) !important;
      font-size: 1rem;
      padding: 10px 20px;
      font-weight: 700 !important;
      animation: pulse 2s infinite;
    }
    
    .btn-activar.destacado:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(34, 197, 94, 0.5);
    }
    
    @keyframes pulse {
      0%, 100% {
        box-shadow: 0 4px 12px rgba(34, 197, 94, 0.4);
      }
      50% {
        box-shadow: 0 4px 16px rgba(34, 197, 94, 0.6);
      }
    }
    
    .btn-desactivar {
      background: var(--accent-primary);
      color: var(--button-text-color);
      padding: 8px 16px;
      border: none;
      border-radius: 8px;
      font-size: 0.9rem;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.2s ease;
    }
    
    .btn-desactivar:hover {
      background: var(--accent-hover);
    }
    
    .btn-editar {
      background: var(--accent-primary) !important;
      color: var(--button-text-color) !important;
    }
    
    .btn-editar:hover {
      background: var(--accent-hover) !important;
    }
    
    .btn-eliminar {
      background: var(--accent-error);
      color: white;
    }
    
    .btn-eliminar:hover {
      background: var(--text-danger);
    }
  </style>

  <script>
    // ===== FUNCIONES DE TABS =====
    function abrirTab(tabId) {
      // Ocultar todos los contenidos de tabs
      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
        tab.style.display = 'none';
      });
      
      // Remover clase activa de todos los botones
      document.querySelectorAll('.tab-button').forEach(btn => {
        btn.classList.remove('active');
      });
      
      // Mostrar el tab seleccionado
      const tabContent = document.getElementById(tabId);
      if (tabContent) {
        tabContent.classList.add('active');
        tabContent.style.display = 'block';
      }
      
      // Activar el bot√≥n correspondiente
      const button = document.getElementById('btn-' + tabId);
      if (button) {
        button.classList.add('active');
      }
    }

    // ===== FUNCIONES DE LUGARES =====
    
    async function guardarLugar() {
      const lugarId = document.getElementById('lugar-id-editar').value;
      const nombre = document.getElementById('lugar-nombre').value.trim();
      const descripcion = document.getElementById('lugar-descripcion').value.trim();
      const boton = document.querySelector('#form-lugar .boton-guardar');
      const mensaje = document.getElementById('mensaje-lugar');
      
      if (!nombre) {
        alert('Por favor, escribe un nombre para el lugar');
        return;
      }
      
      boton.disabled = true;
      boton.querySelector('span').textContent = 'Guardando...';
      
      try {
        const accion = lugarId ? 'actualizar_lugar' : 'crear_lugar';
        const body = lugarId 
          ? { accion, lugar_id: parseInt(lugarId), nombre, descripcion }
          : { accion, nombre, descripcion };
        
        const response = await fetch('/perfil-personal', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(body)
        });
        
        if (!response.ok) {
          const error = await response.json();
          throw new Error(error.error || 'Error al guardar');
        }
        
        const data = await response.json();
        
        if (data.success) {
          mensaje.textContent = lugarId ? '‚úÖ Lugar actualizado correctamente' : '‚úÖ Lugar creado correctamente';
          mensaje.classList.add('mostrar');
          setTimeout(() => {
            mensaje.classList.remove('mostrar');
            window.location.reload();
          }, 1000);
        }
      } catch (error) {
        console.error('Error:', error);
        alert('Error: ' + error.message);
      } finally {
        boton.disabled = false;
        boton.querySelector('span').textContent = lugarId ? 'Actualizar Lugar' : 'Crear Lugar';
      }
    }
    
    function editarLugar(id, nombre, descripcion) {
      document.getElementById('lugar-id-editar').value = id;
      document.getElementById('lugar-nombre').value = nombre;
      document.getElementById('lugar-descripcion').value = descripcion;
      document.getElementById('titulo-form-lugar').textContent = '‚úèÔ∏è Editar Lugar';
      document.getElementById('texto-boton-lugar').textContent = 'Actualizar Lugar';
      document.getElementById('btn-cancelar-lugar').style.display = 'block';
      document.getElementById('form-lugar').scrollIntoView({ behavior: 'smooth' });
    }
    
    function cancelarEdicionLugar() {
      document.getElementById('lugar-id-editar').value = '';
      document.getElementById('lugar-nombre').value = '';
      document.getElementById('lugar-descripcion').value = '';
      document.getElementById('titulo-form-lugar').textContent = '‚ûï Crear Nuevo Lugar';
      document.getElementById('texto-boton-lugar').textContent = 'Crear Lugar';
      document.getElementById('btn-cancelar-lugar').style.display = 'none';
    }
    
    async function activarLugar(id) {
      if (!confirm('¬øActivar este lugar?\n\nSe desactivar√° el lugar actualmente activo (si hay uno).\n\nUna vez activado, aparecer√° en la tabla de "Lugares Activados" y podr√° recibir limpiezas energ√©ticas.')) {
        return;
      }
      
      try {
        const response = await fetch('/perfil-personal', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ accion: 'activar_lugar', lugar_id: id })
        });
        
        if (!response.ok) {
          const errorData = await response.json();
          throw new Error(errorData.error || 'Error al activar');
        }
        
        const data = await response.json();
        if (data.success) {
          alert('‚úÖ Lugar activado correctamente. Ahora aparecer√° en la tabla de "Lugares Activados".');
          window.location.reload();
        } else {
          alert('Error: ' + (data.error || 'Error desconocido'));
        }
      } catch (error) {
        console.error('Error:', error);
        alert('Error al activar el lugar: ' + error.message);
      }
    }
    
    async function desactivarLugar(id) {
      if (!confirm('¬øDesactivar este lugar?\n\nYa no aparecer√° en la tabla de "Lugares Activados" y no recibir√° limpiezas energ√©ticas.')) {
        return;
      }
      
      try {
        const response = await fetch('/perfil-personal', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ accion: 'desactivar_lugar', lugar_id: id })
        });
        
        if (!response.ok) {
          const errorData = await response.json();
          throw new Error(errorData.error || 'Error al desactivar');
        }
        
        const data = await response.json();
        if (data.success) {
          alert('‚úÖ Lugar desactivado correctamente.');
          window.location.reload();
        } else {
          alert('Error: ' + (data.error || 'Error desconocido'));
        }
      } catch (error) {
        console.error('Error:', error);
        alert('Error al desactivar el lugar: ' + error.message);
      }
    }
    
    async function eliminarLugar(id) {
      if (!confirm('¬øEst√°s seguro de que quieres eliminar este lugar?')) {
        return;
      }
      
      try {
        const response = await fetch('/perfil-personal', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ accion: 'eliminar_lugar', lugar_id: id })
        });
        
        if (!response.ok) throw new Error('Error al eliminar');
        
        const data = await response.json();
        if (data.success) {
          window.location.reload();
        }
      } catch (error) {
        console.error('Error:', error);
        alert('Error al eliminar el lugar');
      }
    }
    
    // ===== FUNCIONES DE PROYECTOS =====
    
    async function guardarProyecto() {
      const proyectoId = document.getElementById('proyecto-id-editar').value;
      const nombre = document.getElementById('proyecto-nombre').value.trim();
      const descripcion = document.getElementById('proyecto-descripcion').value.trim();
      const boton = document.querySelector('#form-proyecto .boton-guardar');
      const mensaje = document.getElementById('mensaje-proyecto');
      
      if (!nombre) {
        alert('Por favor, escribe un nombre para el proyecto');
        return;
      }
      
      boton.disabled = true;
      boton.querySelector('span').textContent = 'Guardando...';
      
      try {
        const accion = proyectoId ? 'actualizar_proyecto' : 'crear_proyecto';
        const body = proyectoId 
          ? { accion, proyecto_id: parseInt(proyectoId), nombre, descripcion }
          : { accion, nombre, descripcion };
        
        const response = await fetch('/perfil-personal', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(body)
        });
        
        if (!response.ok) {
          const error = await response.json();
          throw new Error(error.error || 'Error al guardar');
        }
        
        const data = await response.json();
        
        if (data.success) {
          mensaje.textContent = proyectoId ? '‚úÖ Proyecto actualizado correctamente' : '‚úÖ Proyecto creado correctamente';
          mensaje.classList.add('mostrar');
          setTimeout(() => {
            mensaje.classList.remove('mostrar');
            window.location.reload();
          }, 1000);
        }
      } catch (error) {
        console.error('Error:', error);
        alert('Error: ' + error.message);
      } finally {
        boton.disabled = false;
        boton.querySelector('span').textContent = proyectoId ? 'Actualizar Proyecto' : 'Crear Proyecto';
      }
    }
    
    function editarProyecto(id, nombre, descripcion) {
      document.getElementById('proyecto-id-editar').value = id;
      document.getElementById('proyecto-nombre').value = nombre;
      document.getElementById('proyecto-descripcion').value = descripcion;
      document.getElementById('titulo-form-proyecto').textContent = '‚úèÔ∏è Editar Proyecto';
      document.getElementById('texto-boton-proyecto').textContent = 'Actualizar Proyecto';
      document.getElementById('btn-cancelar-proyecto').style.display = 'block';
      document.getElementById('form-proyecto').scrollIntoView({ behavior: 'smooth' });
    }
    
    function cancelarEdicionProyecto() {
      document.getElementById('proyecto-id-editar').value = '';
      document.getElementById('proyecto-nombre').value = '';
      document.getElementById('proyecto-descripcion').value = '';
      document.getElementById('titulo-form-proyecto').textContent = '‚ûï Crear Nuevo Proyecto';
      document.getElementById('texto-boton-proyecto').textContent = 'Crear Proyecto';
      document.getElementById('btn-cancelar-proyecto').style.display = 'none';
    }
    
    async function activarProyecto(id) {
      if (!confirm('¬øActivar este proyecto? Se desactivar√° el proyecto actualmente activo.')) {
        return;
      }
      
      try {
        const response = await fetch('/perfil-personal', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ accion: 'activar_proyecto', proyecto_id: id })
        });
        
        if (!response.ok) throw new Error('Error al activar');
        
        const data = await response.json();
        if (data.success) {
          window.location.reload();
        }
      } catch (error) {
        console.error('Error:', error);
        alert('Error al activar el proyecto');
      }
    }
    
    async function eliminarProyecto(id) {
      if (!confirm('¬øEst√°s seguro de que quieres eliminar este proyecto?')) {
        return;
      }
      
      try {
        const response = await fetch('/perfil-personal', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ accion: 'eliminar_proyecto', proyecto_id: id })
        });
        
        if (!response.ok) throw new Error('Error al eliminar');
        
        const data = await response.json();
        if (data.success) {
          window.location.reload();
        }
      } catch (error) {
        console.error('Error:', error);
        alert('Error al eliminar el proyecto');
      }
    }
    
    // ===== FUNCIONES DE CONFIGURACI√ìN DE TEMA =====
    async function guardarTema() {
      const select = document.getElementById('tema-select');
      const tema = select.value;
      const mensaje = document.getElementById('mensaje-tema');
      
      try {
        const response = await fetch('/perfil-personal', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ accion: 'guardar_tema', tema: tema })
        });
        
        if (!response.ok) {
          const errorData = await response.json().catch(() => ({ error: 'Error al guardar' }));
          throw new Error(errorData.error || 'Error al guardar');
        }
        
        const data = await response.json();
        if (data.success) {
          // Aplicar tema inmediatamente sin recargar
          document.documentElement.setAttribute('data-theme', tema);
          
          mensaje.textContent = '‚úÖ Tema guardado correctamente';
          mensaje.style.display = 'block';
          mensaje.style.background = '#d1fae5';
          mensaje.style.color = '#065f46';
          mensaje.style.padding = '12px';
          mensaje.style.borderRadius = '8px';
          mensaje.style.marginTop = '15px';
          setTimeout(() => {
            mensaje.style.display = 'none';
          }, 3000);
        } else {
          throw new Error(data.error || 'Error al guardar el tema');
        }
      } catch (error) {
        console.error('Error:', error);
        mensaje.textContent = '‚ùå ' + (error.message || 'Error al guardar el tema');
        mensaje.style.display = 'block';
        mensaje.style.background = '#fee2e2';
        mensaje.style.color = '#991b1b';
        mensaje.style.padding = '12px';
        mensaje.style.borderRadius = '8px';
        mensaje.style.marginTop = '15px';
        setTimeout(() => {
          mensaje.style.display = 'none';
        }, 5000);
      }
    }
    
    // ===== FUNCIONES DE CONFIGURACI√ìN DE MEDITACI√ìN =====
    async function guardarTonoMeditacion() {
      const select = document.getElementById('tono-meditacion-select');
      const tonoId = select.value || null;
      const mensaje = document.getElementById('mensaje-tono');
      
      try {
        const response = await fetch('/perfil-personal', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ accion: 'guardar_tono_meditacion', tono_id: tonoId })
        });
        
        if (!response.ok) throw new Error('Error al guardar');
        
        const data = await response.json();
        if (data.success) {
          mensaje.textContent = '‚úÖ Tono de meditaci√≥n guardado correctamente';
          mensaje.style.display = 'block';
          mensaje.style.background = '#d1fae5';
          mensaje.style.color = '#065f46';
          mensaje.style.padding = '12px';
          mensaje.style.borderRadius = '8px';
          mensaje.style.marginTop = '15px';
          setTimeout(() => {
            mensaje.style.display = 'none';
          }, 3000);
        }
      } catch (error) {
        console.error('Error:', error);
        alert('Error al guardar el tono de meditaci√≥n');
      }
    }
  </script>


  <!-- Script para suprimir errores de extensiones del navegador -->
  <script src="/js/error-handler.js"></script>
  
  <!-- Abridor de Typeforms -->
  <script src="/js/typeform-opener.js"></script>
</body>
</html>

